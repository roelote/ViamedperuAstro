---
// src/pages/[slug].astro
export async function getStaticPaths() {
    let pages = [];
    
    try {
        const response = await fetch('http://web.viamed/wp-json/wp/v2/pages?_embed');
        if (response.ok) {
            pages = await response.json();
        }
    } catch (error) {
        console.error('Error al cargar las páginas:', error);
    }

    // Excluir páginas que tienen su propio archivo .astro
    const excludedSlugs = ['nuestras-unidades'];
    
    return pages
        .filter((page: any) => !excludedSlugs.includes(page.slug))
        .map((page: any) => ({
            params: { slug: page.slug },
            props: { page },
        }));
}

interface Props {
    page: {
        title: { rendered: string };
        content: { rendered: string };
        slug: string;
        yoast_head?: string;
        yoast_head_json?: {
            title?: string;
            description?: string;
            og_title?: string;
            og_description?: string;
            og_image?: { url: string }[];
            twitter_card?: string;
            canonical?: string;
        };
    };
}

const { page } = Astro.props;

import Layout from '../layouts/Layout.astro';
import '@fancyapps/ui/dist/fancybox/fancybox.css';

// Obtener metadatos de Yoast SEO
const seoTitle = page.yoast_head_json?.title || page.title.rendered;
const seoDescription = page.yoast_head_json?.description || '';
const ogImage = page.yoast_head_json?.og_image?.[0]?.url || '';
const canonical = page.yoast_head_json?.canonical || '';
---

<Layout 
    title={seoTitle}
    description={seoDescription}
    ogImage={ogImage}
    canonical={canonical}
>
    <div class="">
           
            <div class="relative h-64 md:h-80 mb-4 overflow-hidden" data-aos="fade-up">
                
                <img 
                    src="/hader-pages-viamed.jpg" 
                    alt={page.title.rendered}
                    class="absolute inset-0 w-full h-full object-cover"
                />
               
                <div class="absolute inset-0 bg-viamed-cyan/40"></div>
             
                <div class="relative z-10 flex items-center justify-center h-full">
                    <h1 class="text-4xl md:text-5xl font-bold text-white px-4 text-center">
                        {page.title.rendered}
                    </h1>
                </div>
            </div>

            <div 
                class="bg-white rounded-xl border border-gray-100 shadow-lg p-8 md:p-12 prose prose-lg container mb-16" 
                data-aos="fade-up" 
                data-aos-delay="200"
                set:html={page.content.rendered}
            />
    </div>
</Layout>

<style>
    /* Estilos para el contenido de WordPress */
    :global(.prose) {
        color: #374151;
    }
    
    :global(.prose h1),
    :global(.prose h2),
    :global(.prose h3),
    :global(.prose h4) {
        color: #1f2937;
        font-weight: 700;
        margin-top: 2rem;
        margin-bottom: 1rem;
    }

    :global(.prose h2) {
        font-size: 2rem;
        border-bottom: 2px solid #00bcd4;
        padding-bottom: 0.5rem;
        text-align: center ;
    }
    :global(.prose h3) {
        font-size: 1.2rem;
        padding-bottom: 0.5rem;
    }

    :global(.prose p) {
        margin-bottom: 1.5rem;
        line-height: 1.8;
    }

    :global(.prose a) {
        color: #00bcd4;
        text-decoration: none;
        transition: color 0.3s;
    }

    :global(.prose a:hover) {
        color: #e91e63;
    }

     :global(.wp-block-advgb-list.bgverde) {
  background-color: #cefbffc4;
  border: 1px solid #d9d9d9;
  border-radius: 10px;
  padding: 10px 10px 0px 5px;
  margin-bottom: 20px;
}
 :global(.wp-block-advgb-list.bgrojo) {
  background-color: #ffcece5e;
  border: 1px solid #d9d9d9;
  border-radius: 10px;
  padding: 10px 10px 0px 5px;
  margin-bottom: 20px;
}
:global(.has-inline-color.has-vivid-cyan-blue-color) {
   
  color: #007cff;
    }
    :global(.has-inline-color.has-vivid-red-color)
    {
    color: #ec1c24;
    }

    :global(.prose img) {
        border-radius: 0.5rem;
        margin: 2rem auto;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }
    :global(.advgb-list li) {
        padding-left: 5px !important;
    }

    

    :global(.prose ul),
    :global(.prose ol) {
        margin-left: 2rem;
        margin-bottom: 1.5rem;
    }

    :global(.prose li) {
        margin-bottom: 0.5rem;
    }

    :global(.prose blockquote) {
        border-left: 4px solid #00bcd4;
        padding-left: 1.5rem;
        font-style: italic;
        color: #6b7280;
        margin: 2rem 0;
    }

    /* Estilos para galerías de WordPress */
    :global(.wp-block-gallery) {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 1rem;
        margin: 2rem 0;
    }

    :global(.wp-block-gallery .wp-block-image) {
        margin: 0;
    }

    :global(.wp-block-gallery img) {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-radius: 0.5rem;
        cursor: pointer;
        transition: transform 0.3s, box-shadow 0.3s;
    }

    :global(.wp-block-gallery img:hover) {
        transform: scale(1.05);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }

    /* Estilos para columnas de WordPress */
    :global(.wp-block-columns) {
        display: grid;
        gap: 2rem;
        margin: 2rem 0;
    }

    :global(.wp-block-column) {
        min-width: 0;
    }

    @media (min-width: 768px) {
        :global(.wp-block-columns) {
            grid-template-columns: repeat(auto-fit, minmax(0, 1fr));
        }
        
        :global(.wp-block-columns.has-2-columns) {
            grid-template-columns: repeat(2, 1fr);
        }
        
        :global(.wp-block-columns.has-3-columns) {
            grid-template-columns: repeat(3, 1fr);
        }
        
        :global(.wp-block-columns.has-4-columns) {
            grid-template-columns: repeat(4, 1fr);
        }
    }
</style>

<script>
    import { Fancybox } from '@fancyapps/ui';

    // Esperar a que el contenido esté completamente cargado
    window.addEventListener('load', () => {
        // Configurar Fancybox para galerías de WordPress
        const galleries = document.querySelectorAll('.wp-block-gallery');
        
        galleries.forEach((gallery, index) => {
            // Buscar todos los enlaces dentro de la galería
            const links = gallery.querySelectorAll('a');
            
            links.forEach((link) => {
                const htmlLink = link as HTMLAnchorElement;
                const img = htmlLink.querySelector('img');
                
                if (img) {
                    // Si el enlace ya existe, solo agregar los atributos de Fancybox
                    htmlLink.setAttribute('data-fancybox', `gallery-${index}`);
                    htmlLink.setAttribute('data-caption', (img as HTMLImageElement).alt || '');
                }
            });
            
            // Para imágenes sin enlace en la galería
            const images = gallery.querySelectorAll('img');
            images.forEach((img) => {
                const htmlImg = img as HTMLImageElement;
                
                // Solo si no tiene un enlace padre
                if (img.parentElement && img.parentElement.tagName !== 'A') {
                    const link = document.createElement('a');
                    link.href = htmlImg.src;
                    link.setAttribute('data-fancybox', `gallery-${index}`);
                    link.setAttribute('data-caption', htmlImg.alt || '');
                    
                    if (img.parentNode) {
                        img.parentNode.insertBefore(link, img);
                        link.appendChild(img);
                    }
                }
            });
        });

        // Configurar Fancybox para imágenes individuales fuera de galerías
        const contentLinks = document.querySelectorAll('.prose a:not(.wp-block-gallery a)');
        contentLinks.forEach((link) => {
            const htmlLink = link as HTMLAnchorElement;
            const img = htmlLink.querySelector('img');
            
            if (img && htmlLink.href.match(/\.(jpeg|jpg|gif|png|webp)$/i)) {
                htmlLink.setAttribute('data-fancybox', 'content-images');
                htmlLink.setAttribute('data-caption', (img as HTMLImageElement).alt || '');
            }
        });

        // Configurar imágenes sin enlace
        const contentImages = document.querySelectorAll('.prose img:not(.wp-block-gallery img)');
        contentImages.forEach((img) => {
            const htmlImg = img as HTMLImageElement;
            
            if (img.parentElement && img.parentElement.tagName !== 'A') {
                const link = document.createElement('a');
                link.href = htmlImg.src;
                link.setAttribute('data-fancybox', 'content-images');
                link.setAttribute('data-caption', htmlImg.alt || '');
                
                if (img.parentNode) {
                    img.parentNode.insertBefore(link, img);
                    link.appendChild(img);
                }
            }
        });

        // Inicializar Fancybox
        setTimeout(() => {
            Fancybox.bind('[data-fancybox]', {
                Toolbar: {
                    display: {
                        left: ['infobar'],
                        middle: [],
                        right: ['slideshow', 'thumbs', 'close']
                    }
                },
                Thumbs: {
                    autoStart: true
                }
            } as any);
        }, 100);
    });
</script>